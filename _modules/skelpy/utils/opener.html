
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>skelpy.utils.opener &#8212; skelpy 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for skelpy.utils.opener</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module offers :func:`open_with_associated_application` which</span>
<span class="sd">opens a file with the associated application.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">from</span> <span class="nn">.helpers</span> <span class="k">import</span> <span class="n">has_command</span>


<span class="k">def</span> <span class="nf">_byte2str</span><span class="p">(</span><span class="n">binary_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert byte string to str</span>

<span class="sd">    The purpose of this small function is to convert and to tidy up the</span>
<span class="sd">    return value of :func:`subprocess.check_output()`</span>

<span class="sd">    Args:</span>
<span class="sd">        binary_str: byte string</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: utf-8 string</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">binary_str</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_get_associated_application_linux</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function to find the appropriate application associated with the given file on linux platform</span>

<span class="sd">    Args:</span>
<span class="sd">        filePath (str):  the file name (possibly including path) to open</span>

<span class="sd">        .. Warning::</span>

<span class="sd">            filePath should NOT end with &#39;\&#39; or &#39;/&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: associated application if any, otherwise None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make a ConfigParser instance ready in place</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">configparser</span> <span class="k">import</span> <span class="n">ConfigParser</span><span class="p">,</span> <span class="n">NoOptionError</span>  <span class="c1"># python 3.x</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">ConfigParser</span> <span class="k">import</span> <span class="n">ConfigParser</span><span class="p">,</span> <span class="n">NoOptionError</span>  <span class="c1"># python 2.7</span>

    <span class="n">xdg</span> <span class="o">=</span> <span class="n">has_command</span><span class="p">(</span><span class="s1">&#39;xdg-mime&#39;</span><span class="p">)</span>

    <span class="c1"># sub-functions -----------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_find_mime</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the proper mime for the given file</span>

<span class="sd">        Args:</span>
<span class="sd">            filePath (str): file name(possibly including path) to find mime of</span>

<span class="sd">        Returns:</span>
<span class="sd">            str or None: mime for the given file if any, otherwise None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mime</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">xdg</span><span class="p">:</span>
            <span class="n">mime</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;xdg-mime&#39;</span><span class="p">,</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="s1">&#39;filetype&#39;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">])</span>
            <span class="n">mime</span> <span class="o">=</span> <span class="n">mime</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># guess by file extension</span>
            <span class="kn">import</span> <span class="nn">mimetypes</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filePath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mime</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">types_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mime</span>

    <span class="k">def</span> <span class="nf">_find_desktop</span><span class="p">(</span><span class="n">mime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the proper desktop file for the given mime</span>

<span class="sd">        Args:</span>
<span class="sd">            mime (str): mime to find corresponding desktop file</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: desktop file **without** path info</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mime</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">desktop</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">xdg</span><span class="p">:</span>  <span class="c1"># xdg-mime installed</span>
            <span class="n">desktop</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;xdg-mime&#39;</span><span class="p">,</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">mime</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">desktop</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">desktop</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="c1"># if xdg-mime is not available, examine mimeapps.list &amp; mimeinfo.cache in turn</span>
        <span class="n">searchFile</span> <span class="o">=</span> <span class="s1">&#39;mimeapps.list&#39;</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.config&#39;</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.local/share/applications&#39;</span><span class="p">),</span>
            <span class="p">]</span>

        <span class="n">mimeFile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">searchFile</span><span class="p">)):</span>
                <span class="n">mimeFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">searchFile</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">mimeFile</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">mimeFile</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">mimeFile</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>  <span class="c1"># python 2.7 doesn&#39;t support &#39;fallback&#39; option</span>
                <span class="n">desktop</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Default Applications&#39;</span><span class="p">,</span> <span class="n">mime</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">desktop</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">desktop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">desktop</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Added Associations&#39;</span><span class="p">,</span> <span class="n">mime</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">desktop</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">desktop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># if mimeapps.list fails, try mimeinfo.cache</span>
        <span class="n">searchFile</span> <span class="o">=</span> <span class="s1">&#39;mimeinfo.cache&#39;</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/usr/share/applications&#39;</span><span class="p">]</span>

        <span class="n">mimeFile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">searchFile</span><span class="p">)):</span>
                <span class="n">mimeFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">searchFile</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">mimeFile</span><span class="p">:</span>
            <span class="c1"># reset ConfigParser</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">mimeFile</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">mimeFile</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>  <span class="c1"># desktop should still be None</span>
                <span class="n">desktop</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MIME Cache&#39;</span><span class="p">,</span> <span class="n">mime</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">desktop</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">desktop</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># failed to find appropriate desktop file associated</span>
        <span class="k">return</span> <span class="n">desktop</span>  <span class="c1"># still None</span>

    <span class="k">def</span> <span class="nf">_find_command</span><span class="p">(</span><span class="n">desktop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the command out of the given desktop file</span>

<span class="sd">        Args:</span>
<span class="sd">            desktop (str): desktop file name</span>

<span class="sd">        Returns:</span>
<span class="sd">            str or None: command to run</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">desktop</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.local/share/applications&#39;</span><span class="p">),</span>
                     <span class="s1">&#39;/usr/share/applications&#39;</span><span class="p">,</span>
                     <span class="p">]</span>

        <span class="n">dfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">desktop</span><span class="p">)):</span>
                <span class="n">dfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">desktop</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dfile</span><span class="p">:</span>  <span class="c1"># no such a desktop file</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">dfile</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">dfile</span><span class="p">))</span>

        <span class="n">command</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># python 2.7 doesn&#39;t support fallback option</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Desktop Entry&#39;</span><span class="p">,</span> <span class="s1">&#39;Exec&#39;</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoOptionError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">command</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># final check</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_command</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
                <span class="n">command</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">command</span>
    <span class="c1"># ------------------------------------------------------</span>

    <span class="c1"># now, find the application</span>
    <span class="n">mime</span> <span class="o">=</span> <span class="n">_find_mime</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mime</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">desktop</span> <span class="o">=</span> <span class="n">_find_desktop</span><span class="p">(</span><span class="n">mime</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">desktop</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">application</span> <span class="o">=</span> <span class="n">_find_command</span><span class="p">(</span><span class="n">desktop</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">application</span>


<span class="k">def</span> <span class="nf">_get_associated_application_cygwin</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find the appropriate application associated with the given file on cygwin</span>

<span class="sd">    This function tries to fine cygwin-native application first. If fail,</span>
<span class="sd">    It then searches Windows applications.</span>

<span class="sd">    Args:</span>
<span class="sd">        filePath (str):  the file name(including path) to find the associated application</span>

<span class="sd">        .. Warning::</span>

<span class="sd">            filePath should NOT end with &#39;\&#39; or &#39;/&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        str or None: associated application path if any, otherwise None</span>

<span class="sd">        .. Notes::</span>

<span class="sd">            If the application found is a cygwin-native, it has a *nix-style</span>
<span class="sd">            path(os.sep == &#39;/&#39;). If the found is a Windows application its path is</span>
<span class="sd">            in the windows-style(os.sep == &#39;\\&#39; and optional drive letter).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check cygwin-native applications first</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">_get_associated_application_linux</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">app</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">app</span>

    <span class="c1"># if no native application is available, check Windows applications</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filePath</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ftype</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;/C&#39;</span><span class="p">,</span> <span class="s1">&#39;assoc&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="kn">import</span> <span class="nn">shlex</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">association</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;/C&#39;</span><span class="p">,</span> <span class="s1">&#39;ftype&#39;</span><span class="p">,</span> <span class="n">ftype</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">app</span> <span class="o">=</span> <span class="n">association</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">posix</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># still need a final touch for environment variables like %SystemRoot%</span>
    <span class="c1"># os.path.expandvars() does not work for % style variables on cygwin</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;/C&#39;</span><span class="p">,</span> <span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="n">app</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">_byte2str</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="c1">#: For the compatibility with python 2.7, we do not use keyword-only arguments here.</span>
<div class="viewcode-block" id="open_with_associated_application"><a class="viewcode-back" href="../../../api/skelpy.utils.html#skelpy.utils.opener.open_with_associated_application">[docs]</a><span class="k">def</span> <span class="nf">open_with_associated_application</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open the file with the associated application using the *&quot;general-purpose opener&quot;* program.</span>

<span class="sd">    A &quot;*general-purpose opener*&quot; is a small command-line program which runs a</span>
<span class="sd">    certain application associated to the file type. In a rough sense,</span>
<span class="sd">    what *general-purpose opener* does is like double-clicking the file on a</span>
<span class="sd">    file-manage program such as Explorer of Windows.</span>
<span class="sd">    Below are well-known OSes and their *general-purpose openers*::</span>

<span class="sd">        - Linux: xdg-open</span>
<span class="sd">        - Windows: start</span>
<span class="sd">        - OS X: open</span>
<span class="sd">        - Cygwin: cygstart</span>

<span class="sd">    .. Note::</span>

<span class="sd">        Although :func:`subprocess.call` is a blocking function, Most--well,</span>
<span class="sd">        if not all--general-purpose openers, by default, do not wait until</span>
<span class="sd">        the application terminates. For kind-of blocking mode, Windows(``start``)</span>
<span class="sd">        and OSX(``open``) provide the option &quot;/WAIT&quot; and &quot;-W&quot;, respectively.</span>
<span class="sd">        So, it is possible to run the associated application in the blocking mode</span>
<span class="sd">        just by invoking the *general-purpose opener* with those options.</span>
<span class="sd">        For example, on Windows::</span>

<span class="sd">            start -W sample.txt</span>

<span class="sd">        would make a text editor such as ``notepad.exe`` open the sample.txt file</span>
<span class="sd">        and wait until notepad terminates.</span>

<span class="sd">        However, that is **not** possible on linux and cygwin, because their</span>
<span class="sd">        *general-purpose openers* do not have such options.</span>
<span class="sd">        Thus, for the same effect on linux and cygwin, we have to find</span>
<span class="sd">        the associated application and directly run it.</span>

<span class="sd">        Also be informed that :func:`startfile` function provided by python</span>
<span class="sd">        :mod:`os` module is only for Windows and non-blocking.</span>

<span class="sd">    .. Note::</span>

<span class="sd">        On Cygwin, the path of the application to run should follow the \*nix-style,</span>
<span class="sd">        which uses &#39;/&#39; as the path separator. However, the path-style of the file</span>
<span class="sd">        to open with the application differs from applications.</span>
<span class="sd">        As a matter of fact, Windows applications can not recognize the \*nix-style</span>
<span class="sd">        path. Therefore, when used with a Windows application on Cygwin, the file</span>
<span class="sd">        path should be in the Windows-style which uses &#39;\\\\&#39; as the path</span>
<span class="sd">        separator and an optional drive letter.</span>

<span class="sd">    Args:</span>
<span class="sd">        filePath (str): the file name(possibly including path) to open</span>
<span class="sd">        args (str): other arguments to pass to the application to be invoked</span>
<span class="sd">        block (bool): if True, execute the application in the blocking mode,</span>
<span class="sd">            i.e., wait until the application terminates, otherwise in the</span>
<span class="sd">            non-blocking mode.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: retcode of :func:`subprocess.call` if the application successfully runs,</span>
<span class="sd">        otherwise, i.e., when failed to find an associated application, returns -1</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: remove trailing &#39;\&#39; or &#39;/&#39; if any</span>
    <span class="k">while</span> <span class="n">filePath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filePath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">filePath</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">platform</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span>
    <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">)</span>
        <span class="c1"># cmd.append(&#39;&quot;&quot;&#39;)  # window title</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/WAIT&#39;</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="c1"># On Windows, &quot;start&quot; is a part of &quot;cmd.&quot; so subprocess.call without</span>
        <span class="c1"># &quot;shell=True&quot; would&#39;t work</span>
        <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-W&#39;</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;cygwin&#39;</span><span class="p">:</span>
        <span class="c1"># sub functions ------------------------------------------------------</span>
        <span class="k">def</span> <span class="nf">_tell_path_type</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Tell the type(i.e., Windows-style or *nix-style) of the path given</span>

<span class="sd">            Args:</span>
<span class="sd">                path(str): path to check</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: &#39;windows&#39; if the path is in Windows-style, &#39;unix&#39; otherwise</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># if file name only</span>
            <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span> <span class="ow">and</span> <span class="s1">&#39;/&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">_byte2str</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;which&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/cygdrive&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="s1">&#39;windows&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;unix&#39;</span>

            <span class="c1"># else contain path</span>
            <span class="n">win_path</span> <span class="o">=</span> <span class="n">_byte2str</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;cygpath&#39;</span><span class="p">,</span> <span class="s1">&#39;--windows&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">win_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;windows&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;unix&#39;</span>

        <span class="k">def</span> <span class="nf">_cyg_win2unix</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;convert Windows-style path to Unix-style on **cygwin**</span>

<span class="sd">            Args:</span>
<span class="sd">                path: file path to convert</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: unix-style path</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">unix_path</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;cygpath&#39;</span><span class="p">,</span> <span class="s1">&#39;--unix&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;--proc-cygdrive&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">_byte2str</span><span class="p">(</span><span class="n">unix_path</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_cyg_unix2win</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;convert Unix-style path to Windows-style on **cygwin**</span>

<span class="sd">            Args:</span>
<span class="sd">                path: file path to convert</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: Windows-style path</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">win_path</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;cygpath&#39;</span><span class="p">,</span> <span class="s1">&#39;--windows&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;--long-name&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">])</span>
            <span class="c1"># convert &#39;\&#39; to &#39;\\&#39;</span>
            <span class="n">path_list</span> <span class="o">=</span> <span class="n">_byte2str</span><span class="p">(</span><span class="n">win_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_list</span><span class="p">)</span>
        <span class="c1"># ------------------------------------------------------</span>

        <span class="n">app</span> <span class="o">=</span> <span class="n">_get_associated_application_cygwin</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="n">appType</span> <span class="o">=</span> <span class="n">_tell_path_type</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
            <span class="c1"># we need the *nix-style path for the app regardless of application type.</span>
            <span class="n">app</span> <span class="o">=</span> <span class="n">_cyg_win2unix</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
            <span class="c1"># But for the file to open, need to adjust the path type to applications&#39;</span>
            <span class="k">if</span> <span class="n">appType</span> <span class="o">==</span> <span class="s1">&#39;windows&#39;</span><span class="p">:</span>
                <span class="n">filePath</span> <span class="o">=</span> <span class="n">_cyg_unix2win</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filePath</span> <span class="o">=</span> <span class="n">_cyg_win2unix</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;cygstart&#39;</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># in case that application is None</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">):</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_get_associated_application_linux</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">:</span>
            <span class="c1"># instead of checking xdg-mime installed, simply run in background</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># in case that application is None</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">skelpy</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, dks.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>